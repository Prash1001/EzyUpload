<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Retrieval</title>
<link rel="stylesheet" href="background.css">

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
  }
  .container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  .file-list {
    list-style: none;
    color: black;
    background-color: white;
    padding: 0;
  }
  .file-item {
    margin-bottom: 10px;
    margin-right: 5px;
    margin-top: 10px;
  }
  .file-link {
    display: block;
    text-decoration: none;
    margin: 8px;
    color: #090909;
    background-color: #c5c5c5;
  }

  /* Style for the form input field */
  .code-input {
    margin-bottom: 10px;
    width: 100%;
    max-width: 220px;
    height: 15px;
    padding: 12px;
    border-radius: 12px;
    border: 1.5px solid lightgrey;
    outline: none;
    transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
    box-shadow: 0px 0px 20px -18px;
  }
  
  .code-input:hover {
    border: 2px solid lightgrey;
    box-shadow: 0px 0px 20px -17px;
  }
  
  .code-input:active {
    transform: scale(0.95);
  }
  
  .code-input:focus {
    border: 2px solid grey;
  }
  button {
    color: #090909;
    padding: 0.7em 1.7em;
    font-size: 13px;
    border-radius: 0.5em;
    background: #e8e8e8;
    cursor: pointer;
    border: 1px solid #e8e8e8;
    transition: all 0.3s;
    box-shadow: 6px 6px 12px #c5c5c5, -6px -6px 12px #ffffff;
  }
  
  button:active {
    color: #666;
    box-shadow: inset 4px 4px 12px #c5c5c5, inset -4px -4px 12px #ffffff;
  }

  ul {
    list-style-type: none; /* Remove bullet points from the list */
    margin: 0; /* Remove default margin */
    padding: 0; /* Remove default padding */
    background-color: #333; /* Set background color */
    overflow: hidden; /* Ensure content does not overflow */
  }

  li {
    float: left; /* Float the list items horizontally */
  }

  li b {
    display: block; /* Make the links display as block elements */
    color: white; /* Set text color */
    text-align: center; /* Center align text */
    padding: 14px 16px; /* Add padding */
    text-decoration: none; /* Remove underline from links */
  }

  li a:hover {
    background-color: #4CAF50; /* Change background color on hover */
  }

  .active {
    background-color: #4CAF50; /* Set background color for active link */
  }

  button {
    color: #090909;
    padding: 0.7em 1.7em;
    font-size: 13px;
    border-radius: 0.5em;
    background: #4CAF50;
    cursor: pointer;
    border: 1px solid #e8e8e8;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
    box-shadow: 6px 6px 12px #c5c5c5, -6px -6px 12px #ffffff;
  }

  button:hover {
    background-color: #2f7133; /* Change background color to green on hover */
    color: white; /* Change text color to white on hover */
  }

  button:active {
    background-color: #2e7d32; /* Change background color to darker shade when active */
    color: #666; /* Change text color to darker shade when active */
    box-shadow: inset 4px 4px 12px #c5c5c5, inset -4px -4px 12px #ffffff;
  }

  .info-box {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
  }

  .info-box h3 {
    margin-top: 0;
  }

  .info-box p {
    margin-bottom: 0;
  }

  /* Style for the highlighted file */
  .highlighted {
    background-color: #aff8a5; /* Change background color for highlighted file */
    padding: 10px;
    border-radius: 5px;
  }

  /* Center the highlighted file within the container */
  .highlighted a {
    display: inline-block; /* Set the link to display as inline-block */
    text-align: center; /* Center align the link */
  }
</style>
</head>
<body>
<ul>
  <li id="logo"><a>EasyUpload</a></li>
  <li><a  href="./NextIndex.html">Upload File</a></li>
  <li><a class="active" href="./NextReceive.html">Retrieve File</a></li>
  <li><a href="#" id="sign-out-btn">Sign Out</a></li>
</ul>
<div class="container">
  <h2 style="color: #4CAF50;">File Retrieval</h2>
  <!-- Information box -->
  <div class="info-box">
    <h3>How to Use:</h3>
    <p>Enter the secret code provided when the file was uploaded to retrieve the file.</p>
  </div>
  <!-- Form for code input -->
  <form id="file-retrieve-form">
    <label for="codeInput">Enter Code:</label>
    <input type="text" id="codeInput" class="code-input" required>
    <button type="submit">Retrieve File</button>
  </form>
  <!-- File list -->
  <ul id="fileList" class="file-list"></ul>
  <!-- About EasyUpload -->
  <div class="info-box">
    <h2 style="color: #4CAF50;">About EasyUpload</h2>
    <p style="color: #333">EasyUpload is a simple and efficient file upload and retrieval system designed to make sharing files hassle-free. With EasyUpload, you can securely upload various file types, including images, PDFs, and documents, and retrieve them using unique access codes.</p>
  </div>
  <!-- How It Works -->
  <div class="info-box">
    <h2 style="color: #4CAF50;">How It Works</h2>
    <p style="color: #333"><strong >Upload:</strong> Simply select the file you want to upload, and EasyUpload will generate a unique access code for you.</p>
    <p style="color: #333"><strong>Retrieve:</strong> To retrieve your file, enter the unique access code provided during the upload process, and EasyUpload will fetch your file securely.</p>
  </div>
</div>

<!-- Include Firebase SDKs using script tags -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
  // Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyBX-biPQullJve__X-WHwwzw6oxsiA7tMk",
    authDomain: "ezyupload-da972.firebaseapp.com",
    projectId: "ezyupload-da972",
    storageBucket: "ezyupload-da972.appspot.com",
    messagingSenderId: "563462109953",
    appId: "1:563462109953:web:038176fad3659884a0f900",
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  // Reference to the storage service
  var storage = firebase.storage();

  // Reference to the root of your storage bucket
  var storageRef = storage.ref();

  // Function to retrieve file based on code input
  document.getElementById('file-retrieve-form').addEventListener('submit', function(event) {
    event.preventDefault();
    var code = document.getElementById('codeInput').value.trim();
    if (code.length >= 7) { // Check for 7-character length
      code = code.slice(0, 7); // Take only the first 7 characters
      var fileList = document.getElementById('fileList');
      fileList.innerHTML = ''; // Clear previous file list

      // List all files in the "uploads" directory
      storageRef.child('uploads').listAll().then(function(result) {
        var fileFound = false;

        result.items.forEach(function(itemRef) {
          // Extract the code from the file name
          var fileCode = itemRef.name.split('_')[0];

          // Check if the code matches the provided code
          if (fileCode === code) {
            // Get the download URL for the matching file
            itemRef.getDownloadURL().then(function(url) {
              // Create a link to download the file
              var listItem = document.createElement('li');
              var link = document.createElement('a');
              link.setAttribute('href', url);
              link.setAttribute('class', 'file-link');
              link.setAttribute('download', itemRef.name); // Set the download attribute
              link.textContent = itemRef.name;
              listItem.appendChild(link);
              fileList.appendChild(listItem);
              fileFound = true;
            }).catch(function(error) {
              console.error('Error getting download URL:', error);
            });
          }
        });

        if (!fileFound) {
          fileList.innerHTML = '<li>files found :- </li>';
        }
      }).catch(function(error) {
        console.error('Error listing files:', error);
      });
    } else {
      alert('Please enter a code with at least 7 characters or numbers.');
    }
  });

  // Reference to the Firebase Auth service
  var auth = firebase.auth();

  // Add event listener to the "Sign Out" link
  document.getElementById('sign-out-btn').addEventListener('click', signOutUser);

  // Function to sign out the user
  function signOutUser() {
    auth.signOut().then(() => {
      // Sign-out successful.
      console.log('User signed out successfully');
      // Redirect user to the sign-in page or homepage
      window.location.href = 'Sign.html'; // Change to the appropriate page
    }).catch((error) => {
      // An error happened.
      console.error('Sign-out error:', error);
    });
  }
</script>
</body>
</html>
